<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Client Portal</title>
  <link rel="stylesheet" href="style.css" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lossess</title>
  <!-- iOS Fullscreen Web App Meta Tags -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="YourAppName">
  <!-- Your CSS and other head stuff -->
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  		<title>Dimension by HTML5 UP</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">
		<!-- Wrapper -->
			<div id="wrapper">
				<!-- Header -->
					<header id="header">
						<div class="content">
							<div class="inner">
								<h2 id="greeting">Welcome</h2>
								<p>welcome back!</p>
							</div>
						</div>
						<nav>
							<ul>
								<li><a href="#photo">take a photo</a></li>
								<li><a href="#lunch">Boring stuff</a></li>
								<li><a href="#LB">Leaderboards</a></li>
								<li><a href="#settings">settings</a></li>
								<!--<li><a href="#elements">Elements</a></li>-->
							</ul>
						</nav>
					</header>
				<!-- Main -->
					<div id="main">
						<!-- Breakfast -->
							<article id="photo">
              <h2 class="major">Messanger</h2>
              <!--<input type="file" accept="image/*" id="photoUpload" style="margin-bottom: 10px;" />
               <button onclick="handleUpload()">Upload Photo</button> -->
              <div id="photoPreview" style="margin-top: 15px;">
              <h3 style="margin-top: 30px;">Chat</h3>
              <div id="chatWindow" class="chat-window"></div>
              <div class="chat-input-wrapper">
  <label for="photoUpload" class="upload-icon">
    <svg viewBox="0 0 24 24" width="24" height="24" fill="#2196F3">
      <circle cx="12" cy="12" r="10" fill="#2196F3"/>
      <line x1="12" y1="8" x2="12" y2="16" stroke="#fff" stroke-width="2"/>
      <line x1="8" y1="12" x2="16" y2="12" stroke="#fff" stroke-width="2"/>
    </svg>
  </label>
  <input type="file" accept="image/*" id="photoUpload" style="display: none;" onchange="handleUpload()" />
  
  <input type="text" id="chatMessage" placeholder="Type a message..." />
  <button onclick="sendMessage()">Send</button>
</div>
                <!-- Image will appear here -->
              </div>
            </article>
						<!-- Lunch -->
							<article id="lunch">
              <h2 class="major">Lunch</h2>
            
              <div id="photoPreview" style="margin-top: 15px;">
                <!-- Image will appear here -->
              </div>
            </article>
						<!-- Dinner -->
							<article id="LB">
              <h2 class="major">Leadboards</h2>
              <input type="file" accept="image/*" id="photoUpload" style="margin-bottom: 10px;" />
              <button onclick="handleUpload()">Upload Photo</button>
              <div id="photoPreview" style="margin-top: 15px;">
                <!-- Image will appear here -->
              </div>
            </article>
						<!-- Snacks -->
								<article id="settings">
              <h2 class="major">Settings</h2>
              <input type="file" accept="image/*" id="photoUpload" style="margin-bottom: 10px;" />
              <button onclick="handleUpload()">Upload Photo</button>
              <div id="photoPreview" style="margin-top: 15px;">
                <!-- Image will appear here -->
              </div>
            </article>
						<!-- Elements -->
							<article id="elements">
								<h2 class="major">Elements</h2>

								<section>
									<h3 class="major">Text</h3>
									<p>This is <b>bold</b> and this is <strong>strong</strong>. This is <i>italic</i> and this is <em>emphasized</em>.
									This is <sup>superscript</sup> text and this is <sub>subscript</sub> text.
									This is <u>underlined</u> and this is code: <code>for (;;) { ... }</code>. Finally, <a href="#">this is a link</a>.</p>
									<hr />
									<h2>Heading Level 2</h2>
									<h3>Heading Level 3</h3>
									<h4>Heading Level 4</h4>
									<h5>Heading Level 5</h5>
									<h6>Heading Level 6</h6>
									<hr />
									<h4>Blockquote</h4>
									<blockquote>Fringilla nisl. Donec accumsan interdum nisi, quis tincidunt felis sagittis eget tempus euismod. Vestibulum ante ipsum primis in faucibus vestibulum. Blandit adipiscing eu felis iaculis volutpat ac adipiscing accumsan faucibus. Vestibulum ante ipsum primis in faucibus lorem ipsum dolor sit amet nullam adipiscing eu felis.</blockquote>
									<h4>Preformatted</h4>
								</section>
							</article>
					</div>
        <!-- Dots -->
          <div class="dot-container">
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
          </div>
          <span id="currentTime">Loading time...</span>
				<!-- Footer -->
         <footer class="w3-display-bottommiddle w3-padding-large w3-center">
          <h3 href="#" onclick="signOut()" class="w3-text-white">Sign Out</h3>
            <div id="client-id-display" style="
  position: fixed;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 14px;

  z-index: 1000;
">
  Loading client ID...
</div>
        </footer>

			</div>
		<!-- BG -->
			<div id="bg"></div>
		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
<style>
body {
  padding-top: env(safe-area-inset-top);
  padding-left: env(safe-area-inset-left);
  padding-right: env(safe-area-inset-right);
  padding-bottom: env(safe-area-inset-bottom);
  margin: 0;
}
body,h1 {font-family: "Raleway", sans-serif}
  .dot-container {
    display: flex;
    justify-content: center;
    margin: 40px 0;
    gap: 8px;
  }
  .dot {
    width: 10px;
    height: 10px;
    background-color: #888;
    border-radius: 50%;
    display: inline-block;
  }
body, html {
  background-color: black; /* or your app bg color */
  height: 100%;
  margin: 0;
}
.chat-input-wrapper {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: 10px;
}

.chat-window {
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: 15px;
  background: rgba(255, 255, 255, 0.1); /* slightly more transparent */
  backdrop-filter: blur(10px); /* frosted glass effect */
  -webkit-backdrop-filter: blur(10px);
  padding: 15px;
  height: 250px;
  overflow-y: auto;
  margin-bottom: 10px;
  color: black;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.upload-icon {
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 6px;
  border-radius: 50%;
  transition: background 0.3s;
}

.upload-icon:hover {
  background: rgba(33, 150, 243, 0.1);
}

.chat-input-wrapper input[type="text"] {
  flex: 1;
  padding: 8px;
  border-radius: 10px;
  border: 1px solid #ccc;
  font-size: 1em;
}

.chat-input-wrapper button {
  padding: 8px 16px;
  border: none;
  border-radius: 10px;
  background: #2196F3;
  color: white;
  cursor: pointer;
}




</style>
<!--JS-->
    <!-- Scripts -->
  <script src="assets/js/jquery.min.js"></script>
  <script src="assets/js/browser.min.js"></script>
  <script src="assets/js/breakpoints.min.js"></script>
  <script src="assets/js/util.js"></script>
  <script src="assets/js/main.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Show client ID from sessionStorage
      const clientId = sessionStorage.getItem('clientId');
      const display = document.getElementById('client-id-display');
      if (clientId) {
        display.textContent = "Client ID: " + clientId;
      } else {
        display.textContent = "Client ID not found.";
      }

      // Greeting using lastName
      const lastName = sessionStorage.getItem('lastName');
      if (lastName) {
        document.getElementById('greeting').textContent = `Hey ${lastName} ðŸ‘‹`;
      }

      // Update clock every second
      function updateTime() {
        const now = new Date();
        const formatted = now.toLocaleTimeString();
        document.getElementById('currentTime').textContent = `Current Time: ${formatted}`;
      }
      updateTime();
      setInterval(updateTime, 1000);
    });

    // Photo Upload Handler for main chat section
    function handleUpload() {
      const fileInput = document.getElementById("photoUpload");
      const previewDiv = document.getElementById("photoPreview");
      if (fileInput.files.length === 0) {
        alert("Please choose a photo first.");
        return;
      }
      const file = fileInput.files[0];
      const reader = new FileReader();
      reader.onload = function (e) {
        previewDiv.innerHTML = `
          <p><strong>Time of Day:</strong> Breakfast</p>
          <img src="${e.target.result}" alt="Uploaded photo" style="max-width: 100%; height: auto; border: 1px solid #ccc; padding: 5px;" />
        `;
      };
      reader.readAsDataURL(file);
    }

    // Other upload handlers (for leaderboards and settings) â€” you can implement similarly
    function handleUploadLB() {
      const fileInput = document.getElementById("photoUploadLB");
      const previewDiv = document.getElementById("photoPreviewLB");
      if (fileInput.files.length === 0) {
        alert("Please choose a photo first.");
        return;
      }
      const file = fileInput.files[0];
      const reader = new FileReader();
      reader.onload = function (e) {
        previewDiv.innerHTML = `<img src="${e.target.result}" alt="Uploaded photo LB" style="max-width:100%; height:auto; border:1px solid #ccc; padding:5px;" />`;
      };
      reader.readAsDataURL(file);
    }

    function handleUploadSettings() {
      const fileInput = document.getElementById("photoUploadSettings");
      const previewDiv = document.getElementById("photoPreviewSettings");
      if (fileInput.files.length === 0) {
        alert("Please choose a photo first.");
        return;
      }
      const file = fileInput.files[0];
      const reader = new FileReader();
      reader.onload = function (e) {
        previewDiv.innerHTML = `<img src="${e.target.result}" alt="Uploaded photo Settings" style="max-width:100%; height:auto; border:1px solid #ccc; padding:5px;" />`;
      };
      reader.readAsDataURL(file);
    }

    async function sendMessage() {
      const messageInput = document.getElementById("chatMessage");
      const chatWindow = document.getElementById("chatWindow");
      const message = messageInput.value.trim();

      if (!message) return;

      // Display user message
      const userDiv = document.createElement("div");
      userDiv.textContent = message;
      userDiv.style.marginBottom = "5px";
      userDiv.style.padding = "6px 10px";
      userDiv.style.borderRadius = "8px";
      userDiv.style.background = "#e0f7fa";
      userDiv.style.alignSelf = "flex-start";
      chatWindow.appendChild(userDiv);
      chatWindow.scrollTop = chatWindow.scrollHeight;
      messageInput.value = "";

      // Placeholder for streaming response
      const responseDiv = document.createElement("div");
      responseDiv.textContent = "";
      responseDiv.style.marginBottom = "5px";
      responseDiv.style.padding = "6px 10px";
      responseDiv.style.borderRadius = "8px";
      responseDiv.style.background = "#fff9c4";
      responseDiv.style.alignSelf = "flex-end";
      chatWindow.appendChild(responseDiv);

      // Call backend API streaming response
      try {
        const res = await fetch("/api/stream-response", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message }),
        });

        if (!res.body) {
          responseDiv.textContent = "No response body from server.";
          return;
        }

        const reader = res.body.getReader();
        const decoder = new TextDecoder();
        let done = false;

        while (!done) {
          const { value, done: readerDone } = await reader.read();
          if (value) {
            const chunk = decoder.decode(value, { stream: true });
            responseDiv.textContent += chunk;
            chatWindow.scrollTop = chatWindow.scrollHeight;
          }
          done = readerDone;
        }
      } catch (error) {
        responseDiv.textContent = "Error fetching response.";
        console.error(error);
      }
    }

    // Dummy signOut for footer link
    function signOut() {
      alert("Signing out...");
      // Add your sign-out logic here
    }
  </script>
</body>
</html>